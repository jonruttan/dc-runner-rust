version: 1
title: bundle_manifest_v1
type: object
required:
  - bundle_id
  - bundle_version
  - summary
  - maintainers
  - dependency_mode
  - depends_on
  - domains
  - declaration_provenance
properties:
  bundle_id:
    type: string
    minLength: 1
  bundle_version:
    type: string
    minLength: 1
  summary:
    type: string
    minLength: 1
  maintainers:
    type: array
    minItems: 1
    items:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          minLength: 1
        contact:
          type: string
          minLength: 1
  dependency_mode:
    type: string
    enum:
      - required
      - optional
    default: required
  depends_on:
    type: array
    items:
      type: string
      minLength: 1
  domains:
    type: array
    minItems: 1
    items:
      type: object
      required:
        - id
        - modules
      properties:
        id:
          type: string
          minLength: 1
        modules:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - id
              - contracts
              - resource_kinds
              - selection_policy
            properties:
              id:
                type: string
                minLength: 1
              contracts:
                description: Canonical contract declarations inspected for selector derivation.
                type: array
                minItems: 1
                items:
                  type: string
                  minLength: 1
              resource_kinds:
                type: array
                minItems: 1
                items:
                  type: string
                  enum:
                    - asset
              selection_policy:
                type: object
                required:
                  - refs
                  - artifacts
                properties:
                  refs:
                    type: string
                    enum:
                      - static_local_only
                  artifacts:
                    type: string
                    enum:
                      - exclude_produced
              artifacts:
                type: array
                items:
                  type: object
                  required:
                    - path
                    - kind
                  properties:
                    path:
                      type: string
                      minLength: 1
                    kind:
                      type: string
                      enum:
                        - file
                        - dir
                        - report
                        - manifest
                        - lock
  declaration_provenance:
    type: object
    required:
      - declaration_sha256
      - declaration_paths
    properties:
      declaration_sha256:
        type: string
        minLength: 1
      declaration_paths:
        type: array
        minItems: 1
        items:
          type: string
          minLength: 1
  applies_to_runners:
    type: array
    items:
      type: string
      enum:
        - python
        - php
        - rust
